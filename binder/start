#!/bin/bash

echo "ðŸš€ Halo Neural Compute - Container Starting..."

# Add bin to PATH
export PATH="$HOME/bin:$PATH"

# Check if this is first launch
if [ ! -f "$HOME/.halo-initialized" ]; then
    echo ""
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "ðŸŽ‰ Welcome to Halo Neural Compute on MyBinder!"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo ""
    echo "ðŸ“ This is your first launch. Setup is required."
    echo ""
    echo "âš¡ Quick Setup (Recommended):"
    echo "   Open a terminal and run:"
    echo "   â†’ setup-halo-complete.sh"
    echo ""
    echo "ðŸ“Š Manual Setup (Advanced):"
    echo "   1. install-ollama.sh        # Download Ollama binary"
    echo "   2. setup-agent-zero.sh      # Install Agent Zero"
    echo "   3. Start services manually"
    echo ""
    echo "ðŸ” Check status anytime:"
    echo "   â†’ halo-status.sh"
    echo ""
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo ""
    
    # Option: Auto-run setup in background (uncomment if desired)
    # echo "ðŸ”„ Starting automatic setup in background..."
    # (
    #     bash "$HOME/bin/setup-halo-complete.sh" && \
    #     touch "$HOME/.halo-initialized"
    # ) > "$HOME/halo-setup.log" 2>&1 &
    # echo "ðŸ“ Setup progress: tail -f ~/halo-setup.log"
else
    echo "âœ… Halo system already initialized"
    
    # Auto-start services if they were running before
    if [ -f "$HOME/bin/ollama" ] && [ ! -f "$HOME/.ollama.pid" ]; then
        echo "ðŸ”„ Starting Ollama server..."
        "$HOME/bin/ollama" serve > "$HOME/ollama.log" 2>&1 &
        echo $! > "$HOME/.ollama.pid"
    fi
    
    if [ -d "$HOME/agent-zero" ] && [ ! -f "$HOME/.agent-zero.pid" ]; then
        echo "ðŸ¤– Starting Agent Zero..."
        cd "$HOME/agent-zero"
        python run_ui.py > "$HOME/agent-zero.log" 2>&1 &
        echo $! > "$HOME/.agent-zero.pid"
    fi
fi

# Start Jupyter (pass through all arguments)
echo "ðŸ““ Starting Jupyter Notebook..."
exec "$@"
