#!/bin/bash
set -e

echo "ðŸŽ¯ Halo Neural Compute - Post-Build Setup"

# Create bin directory
mkdir -p "$HOME/bin"
export PATH="$HOME/bin:$PATH"

# Download Ollama
echo "ðŸ“¦ Installing Ollama..."
wget -q https://github.com/ollama/ollama/releases/download/v0.3.14/ollama-linux-amd64 -O "$HOME/bin/ollama"
chmod +x "$HOME/bin/ollama"

# Download sshx
echo "ðŸ“¦ Installing sshx..."
wget -q https://github.com/ekzhang/sshx/releases/latest/download/sshx-x86_64-unknown-linux-gnu.tar.gz -O /tmp/sshx.tar.gz
mkdir -p /tmp/sshx
 tar -xzf /tmp/sshx.tar.gz -C /tmp/sshx
cp /tmp/sshx/sshx "$HOME/bin/sshx" 2>/dev/null || true
chmod +x "$HOME/bin/sshx" || true

# Clone Agent Zero
echo "ðŸ“¦ Cloning Agent Zero..."
git clone https://github.com/frdel/agent-zero.git "$HOME/agent-zero" || true
cd "$HOME/agent-zero"
pip install -r requirements.txt

# Create Agent Zero config
cat > "$HOME/agent-zero/.env" << 'EOC'
CHAT_MODEL_NAME=qwen2.5:7b
UTIL_MODEL_NAME=qwen2.5:7b
CODE_EXEC_MODEL_NAME=qwen2.5:7b
EMBEDDINGS_MODEL_NAME=nomic-embed-text
OLLAMA_BASE_URL=http://localhost:11434
AGENT_MAX_MEMORY_SIZE=50000
CONTEXT_WINDOW_SIZE=32768
MAX_CONCURRENT_AGENTS=8
EOC

echo "âœ… Post-Build Complete!"
